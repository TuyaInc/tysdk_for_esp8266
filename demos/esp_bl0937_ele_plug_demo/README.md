# 电量统计单插

PID：86tqxuhuvlzrrqel

## 硬件IO口说明：

| 功能         | IO口 | 高低有效   |
| ------------ | ---- | ---------- |
| 继电器       | IO14 | 高电平有效 |
| 继电器指示灯 | 无   |            |
| 开关按键     | IO3  | 低电平有效 |
| wifi指示灯   | IO13 | 低电平有效 |

## 功能说明

### 计量部分信息

工作电压220V，过流点：17A，采样电阻１毫欧；计量芯片：ｂｌ０９３７；

### 电量统计（CF）

IO４- 电流电压检测（CF１）

IO5 - 电流电压切换（SEL）

IO12 - 电平为直连模式

### 网络状态对应指示灯

未配网	指示继电器状态

配网中	快闪（２５０ｍｓ闪烁）和慢闪（１５００ｍｓ闪烁）	

配网失败	指示继电器状态

配网成功	指示继电器状态

### 配置说明

1.wifi模式为WCM_OLD_LOW，上电低功耗模式，长按按键5秒进入配网模式；

2.上电默认断电状态；

## 文件功能模块介绍

| 文件         | 功能介绍                                                     |
| ------------ | ------------------------------------------------------------ |
| device.c     | 应用模块主框架，包含设备初始化，整机产测部分的回调，操作回调等； |
| app_switch.c | 开关部分功能逻辑，指示灯的显示，倒计时功能；                 |
| app_dltj.h   | 电量实时参数（电流电压功率）上报逻辑和对应的事件处理，电量增量上报逻辑，离线电量存储，未配网状态下电量的存储 |
| bl0937.c     | 电量统计芯片bl0937的驱动部分，主要是芯片的硬件初始化，电流、电压、功率和电量的计算，产测校准处理 |





